export const bulkdata = [
    {
        "OrderIDs": [
            "21817"
        ],
        "OrderItemDetails": [
            {
                "id": 128027,
                "Item": 1,
                "ItemName": "Mango Burfi 250 g",
                "Quantity": "20.000",
                "MRP": 781,
                "MRPValue": "235.00",
                "Rate": "190.24",
                "Unit": 1,
                "UnitName": "No",
                "DeletedMCUnitsUnitID": 1,
                "ConversionUnit": "1.000",
                "BaseUnitQuantity": "20.000",
                "GST": 151,
                "HSNCode": "21069099",
                "GSTPercentage": "5.00",
                "Margin": null,
                "MarginValue": null,
                "BasicAmount": "3804.80",
                "GSTAmount": "190.24",
                "CGST": "95.12",
                "SGST": "95.12",
                "IGST": "0.00",
                "CGSTPercentage": "2.50",
                "SGSTPercentage": "2.50",
                "IGSTPercentage": "0.00",
                "Amount": "3995.04",
                "DiscountType": "",
                "Discount": "",
                "UnitDetails": [
                    {
                        "UnitID": 1,
                        "UnitName": "No",
                        "BaseUnitQuantity": "1.000",
                        "PODefaultUnit": false,
                        "SODefaultUnit": true,
                        "Rate": 190.24,
                        "BaseUnitQuantityNoUnit": "1.000",
                        "DeletedMCUnitsUnitID": 1
                    },
                    {
                        "UnitID": 2,
                        "UnitName": "Kg (4 No)",
                        "BaseUnitQuantity": "4.000",
                        "PODefaultUnit": false,
                        "SODefaultUnit": false,
                        "Rate": 190.24,
                        "BaseUnitQuantityNoUnit": "1.000",
                        "DeletedMCUnitsUnitID": 2
                    },
                    {
                        "UnitID": 3,
                        "UnitName": "Box (20 No)",
                        "BaseUnitQuantity": "20.000",
                        "PODefaultUnit": true,
                        "SODefaultUnit": false,
                        "Rate": 190.24,
                        "BaseUnitQuantityNoUnit": "1.000",
                        "DeletedMCUnitsUnitID": 4
                    }
                ],
                "StockDetails": [
                    {
                        "id": 223799,
                        "Item": 1,
                        "BatchDate": "2023-12-24",
                        "BatchCode": "24RL2023",
                        "SystemBatchDate": "2023-12-29",
                        "SystemBatchCode": "20231229_1_14_0",
                        "LiveBatche": 81795,
                        "LiveBatcheMRPID": 781,
                        "LiveBatcheGSTID": 151,
                        "Rate": 190.24,
                        "MRP": "235.00",
                        "GST": "5.00",
                        "UnitName": "No",
                        "BaseUnitQuantity": "100.000"
                    },
                    {
                        "id": 231483,
                        "Item": 1,
                        "BatchDate": "2023-12-30",
                        "BatchCode": "30RL2023",
                        "SystemBatchDate": "2024-01-03",
                        "SystemBatchCode": "20240103_1_14_0",
                        "LiveBatche": 89479,
                        "LiveBatcheMRPID": 781,
                        "LiveBatcheGSTID": 151,
                        "Rate": 190.24,
                        "MRP": "235.00",
                        "GST": "5.00",
                        "UnitName": "No",
                        "BaseUnitQuantity": "160.000"
                    }
                ]
            },
            {
                "id": 128029,
                "Item": 6,
                "ItemName": "Bakarwadi 250 g Tray",
                "Quantity": "80.000",
                "MRP": 626,
                "MRPValue": "110.00",
                "Rate": "84.27",
                "Unit": 17,
                "UnitName": "No",
                "DeletedMCUnitsUnitID": 1,
                "ConversionUnit": "1.000",
                "BaseUnitQuantity": "80.000",
                "GST": 6,
                "HSNCode": "21069099",
                "GSTPercentage": "12.00",
                "Margin": null,
                "MarginValue": null,
                "BasicAmount": "6741.60",
                "GSTAmount": "809.00",
                "CGST": "404.50",
                "SGST": "404.50",
                "IGST": "0.00",
                "CGSTPercentage": "6.00",
                "SGSTPercentage": "6.00",
                "IGSTPercentage": "0.00",
                "Amount": "7550.60",
                "DiscountType": "",
                "Discount": "",
                "UnitDetails": [
                    {
                        "UnitID": 17,
                        "UnitName": "No",
                        "BaseUnitQuantity": "1.000",
                        "PODefaultUnit": false,
                        "SODefaultUnit": true,
                        "Rate": 84.27,
                        "BaseUnitQuantityNoUnit": "1.000",
                        "DeletedMCUnitsUnitID": 1
                    },
                    {
                        "UnitID": 18,
                        "UnitName": "Kg (4 No)",
                        "BaseUnitQuantity": "4.000",
                        "PODefaultUnit": false,
                        "SODefaultUnit": false,
                        "Rate": 84.27,
                        "BaseUnitQuantityNoUnit": "1.000",
                        "DeletedMCUnitsUnitID": 2
                    },
                    {
                        "UnitID": 19,
                        "UnitName": "Box (40 No)",
                        "BaseUnitQuantity": "40.000",
                        "PODefaultUnit": true,
                        "SODefaultUnit": false,
                        "Rate": 84.27,
                        "BaseUnitQuantityNoUnit": "1.000",
                        "DeletedMCUnitsUnitID": 4
                    }
                ],
                "StockDetails": [
                    {
                        "id": 226450,
                        "Item": 6,
                        "BatchDate": "2023-12-25",
                        "BatchCode": "25RL2023",
                        "SystemBatchDate": "2024-01-01",
                        "SystemBatchCode": "20240101_6_14_0",
                        "LiveBatche": 84446,
                        "LiveBatcheMRPID": 626,
                        "LiveBatcheGSTID": 6,
                        "Rate": 84.27,
                        "MRP": "110.00",
                        "GST": "12.00",
                        "UnitName": "No",
                        "BaseUnitQuantity": "144.000"
                    },
                    {
                        "id": 231484,
                        "Item": 6,
                        "BatchDate": "2023-12-25",
                        "BatchCode": "25RL2023",
                        "SystemBatchDate": "2024-01-03",
                        "SystemBatchCode": "20240103_6_14_0",
                        "LiveBatche": 89480,
                        "LiveBatcheMRPID": 626,
                        "LiveBatcheGSTID": 6,
                        "Rate": 84.27,
                        "MRP": "110.00",
                        "GST": "12.00",
                        "UnitName": "No",
                        "BaseUnitQuantity": "120.000"
                    },
                    {
                        "id": 231485,
                        "Item": 6,
                        "BatchDate": "2023-12-26",
                        "BatchCode": "26RL2023",
                        "SystemBatchDate": "2024-01-03",
                        "SystemBatchCode": "20240103_6_14_1",
                        "LiveBatche": 89481,
                        "LiveBatcheMRPID": 626,
                        "LiveBatcheGSTID": 6,
                        "Rate": 84.27,
                        "MRP": "110.00",
                        "GST": "12.00",
                        "UnitName": "No",
                        "BaseUnitQuantity": "1680.000"
                    }
                ]
            },
            {
                "id": 128028,
                "Item": 7,
                "ItemName": "Bakarwadi 500 g Tray",
                "Quantity": "20.000",
                "MRP": 627,
                "MRPValue": "210.00",
                "Rate": "160.88",
                "Unit": 515,
                "UnitName": "No",
                "DeletedMCUnitsUnitID": 1,
                "ConversionUnit": "1.000",
                "BaseUnitQuantity": "20.000",
                "GST": 7,
                "HSNCode": "21069099",
                "GSTPercentage": "12.00",
                "Margin": null,
                "MarginValue": null,
                "BasicAmount": "3217.60",
                "GSTAmount": "386.12",
                "CGST": "193.06",
                "SGST": "193.06",
                "IGST": "0.00",
                "CGSTPercentage": "6.00",
                "SGSTPercentage": "6.00",
                "IGSTPercentage": "0.00",
                "Amount": "3603.72",
                "DiscountType": "",
                "Discount": "",
                "UnitDetails": [
                    {
                        "UnitID": 515,
                        "UnitName": "No",
                        "BaseUnitQuantity": "1.000",
                        "PODefaultUnit": false,
                        "SODefaultUnit": true,
                        "Rate": 160.88,
                        "BaseUnitQuantityNoUnit": "1.000",
                        "DeletedMCUnitsUnitID": 1
                    },
                    {
                        "UnitID": 516,
                        "UnitName": "Kg (2 No)",
                        "BaseUnitQuantity": "2.000",
                        "PODefaultUnit": false,
                        "SODefaultUnit": false,
                        "Rate": 160.88,
                        "BaseUnitQuantityNoUnit": "1.000",
                        "DeletedMCUnitsUnitID": 2
                    },
                    {
                        "UnitID": 517,
                        "UnitName": "Box (20 No)",
                        "BaseUnitQuantity": "20.000",
                        "PODefaultUnit": true,
                        "SODefaultUnit": false,
                        "Rate": 160.88,
                        "BaseUnitQuantityNoUnit": "1.000",
                        "DeletedMCUnitsUnitID": 4
                    }
                ],
                "StockDetails": [
                    {
                        "id": 226452,
                        "Item": 7,
                        "BatchDate": "2023-12-13",
                        "BatchCode": "13RL2023",
                        "SystemBatchDate": "2024-01-01",
                        "SystemBatchCode": "20240101_7_14_1",
                        "LiveBatche": 84448,
                        "LiveBatcheMRPID": 627,
                        "LiveBatcheGSTID": 7,
                        "Rate": 160.88,
                        "MRP": "210.00",
                        "GST": "12.00",
                        "UnitName": "No",
                        "BaseUnitQuantity": "13.000"
                    },
                    {
                        "id": 231486,
                        "Item": 7,
                        "BatchDate": "2023-12-16",
                        "BatchCode": "16RL2023",
                        "SystemBatchDate": "2024-01-03",
                        "SystemBatchCode": "20240103_7_14_0",
                        "LiveBatche": 89482,
                        "LiveBatcheMRPID": 627,
                        "LiveBatcheGSTID": 7,
                        "Rate": 160.88,
                        "MRP": "210.00",
                        "GST": "12.00",
                        "UnitName": "No",
                        "BaseUnitQuantity": "400.000"
                    }
                ]
            }
        ]
    }
    , {
        "OrderIDs": [
            "218179"
        ],
        "OrderItemDetails": [
            {
                "id": 1280279,
                "Item": 1,
                "ItemName": "Mango Burfi 250 g",
                "Quantity": "20.000",
                "MRP": 781,
                "MRPValue": "235.00",
                "Rate": "190.24",
                "Unit": 1,
                "UnitName": "No",
                "DeletedMCUnitsUnitID": 1,
                "ConversionUnit": "1.000",
                "BaseUnitQuantity": "20.000",
                "GST": 151,
                "HSNCode": "21069099",
                "GSTPercentage": "5.00",
                "Margin": null,
                "MarginValue": null,
                "BasicAmount": "3804.80",
                "GSTAmount": "190.24",
                "CGST": "95.12",
                "SGST": "95.12",
                "IGST": "0.00",
                "CGSTPercentage": "2.50",
                "SGSTPercentage": "2.50",
                "IGSTPercentage": "0.00",
                "Amount": "3995.04",
                "DiscountType": "",
                "Discount": "",
                "UnitDetails": [
                    {
                        "UnitID": 1,
                        "UnitName": "No",
                        "BaseUnitQuantity": "1.000",
                        "PODefaultUnit": false,
                        "SODefaultUnit": true,
                        "Rate": 190.24,
                        "BaseUnitQuantityNoUnit": "1.000",
                        "DeletedMCUnitsUnitID": 1
                    },
                    {
                        "UnitID": 2,
                        "UnitName": "Kg (4 No)",
                        "BaseUnitQuantity": "4.000",
                        "PODefaultUnit": false,
                        "SODefaultUnit": false,
                        "Rate": 190.24,
                        "BaseUnitQuantityNoUnit": "1.000",
                        "DeletedMCUnitsUnitID": 2
                    },
                    {
                        "UnitID": 3,
                        "UnitName": "Box (20 No)",
                        "BaseUnitQuantity": "20.000",
                        "PODefaultUnit": true,
                        "SODefaultUnit": false,
                        "Rate": 190.24,
                        "BaseUnitQuantityNoUnit": "1.000",
                        "DeletedMCUnitsUnitID": 4
                    }
                ],
                "StockDetails": [
                    {
                        "id": 223799,
                        "Item": 1,
                        "BatchDate": "2023-12-24",
                        "BatchCode": "24RL2023",
                        "SystemBatchDate": "2023-12-29",
                        "SystemBatchCode": "20231229_1_14_0",
                        "LiveBatche": 81795,
                        "LiveBatcheMRPID": 781,
                        "LiveBatcheGSTID": 151,
                        "Rate": 190.24,
                        "MRP": "235.00",
                        "GST": "5.00",
                        "UnitName": "No",
                        "BaseUnitQuantity": "100.000"
                    },
                    {
                        "id": 231483,
                        "Item": 1,
                        "BatchDate": "2023-12-30",
                        "BatchCode": "30RL2023",
                        "SystemBatchDate": "2024-01-03",
                        "SystemBatchCode": "20240103_1_14_0",
                        "LiveBatche": 89479,
                        "LiveBatcheMRPID": 781,
                        "LiveBatcheGSTID": 151,
                        "Rate": 190.24,
                        "MRP": "235.00",
                        "GST": "5.00",
                        "UnitName": "No",
                        "BaseUnitQuantity": "160.000"
                    }
                ]
            },

        ]
    }

]

export const data = [
    {
        "OrderIDs": [
            "21817"
        ],
        "OrderItemDetails": [
            {
                "Item": 1,//itemid
                "ItemName": "Mango Burfi 250 g",
                "Quantity": "20.000",//order quantity
                "StockDetails": [
                    {
                        "id": 223799, //stock id
                        "Item": 1,//item id
                        "BatchCode": "24RL2023",
                        "BaseUnitQuantity": "100.000"
                    },
                    {
                        "id": 231483,//stock id
                        "Item": 1,//item id
                        "BatchCode": "30RL2023",
                        "BaseUnitQuantity": "160.000"
                    }
                ]
            },

        ]
    },
    {
        "OrderIDs": [
            "21818"
        ],
        "OrderItemDetails": [
            {
                "Item": 1,//itemid
                "ItemName": "Mango Burfi 250 g",
                "Quantity": "30",//order quantity
                "StockDetails": [
                    {
                        "id": 223799, //stock id
                        "Item": 1,//item id
                        "BatchCode": "24RL2023",
                        "BaseUnitQuantity": "100.000"
                    },
                    {
                        "id": 231483,//stock id
                        "Item": 1,//item id
                        "BatchCode": "30RL2023",
                        "BaseUnitQuantity": "160.000"
                    }
                ]
            }
        ]
    }

]


const result = {};

bulkdata.forEach(dataObject => {
    dataObject.OrderItemDetails.forEach(item => {
        let totalItemStock = 0;
        const itemId = `itemId-${item.Item}`;
        item.StockDetails.forEach(stockDetail => {
            const stockId = `stockId-${stockDetail.id}`;
            const stock = parseFloat(stockDetail.BaseUnitQuantity)
            if (!result[itemId]) {
                result[itemId] = {};
            }

            if (!result[itemId][stockId]) {
                result[itemId][stockId] = {
                    baseQty: stock
                };
            }
            totalItemStock += stock
        });
        result[itemId].totalStock = totalItemStock
    });
});


// console.log("result", result);
let asas = {
    "itemId-1": { "stockId-223799": { "baseQty": 100 }, "stockId-231483": { "baseQty": 160 }, "totalStock": 260 },
};

let newGlobalStock = { ...result }

let orderDistribution = {};


bulkdata.forEach(order => {
    // debugger
    let orderId = `orderId-${order.OrderIDs[0]}`;

    order.OrderItemDetails.forEach(orderItem => {
        let itemId = `itemId-${orderItem.Item}`;
        orderDistribution[orderId] = orderDistribution[orderId] || {};
        orderDistribution[orderId][itemId] = orderDistribution[orderId][itemId] || { lessStock: 0 };

        let orderQty = parseFloat(orderItem.Quantity);

        orderItem.StockDetails.forEach(stockDetail => {
            let stockId = `stockId-${stockDetail.id}`;

            let batchStock = newGlobalStock[itemId][stockId].baseQty;
            let itemStock = newGlobalStock[itemId].totalStock;
            let distribute = 0;
            let remaining = 0;

            if (itemStock > 0) {
                if (batchStock >= orderQty) {

                    distribute = orderQty;
                    remaining = batchStock - orderQty;
                    newGlobalStock[itemId].totalStock = itemStock - orderQty;
                    newGlobalStock[itemId][stockId].baseQty = batchStock - orderQty;
                    orderQty = 0;

                } else if (batchStock > 0) {

                    distribute = batchStock;
                    remaining = 0;
                    newGlobalStock[itemId].totalStock = itemStock - batchStock;
                    newGlobalStock[itemId][stockId].baseQty = 0;
                    orderQty = orderQty - batchStock;
                }
            }

            orderDistribution[orderId][itemId][stockId] = {
                "distribute": distribute,
                "remaining": remaining
            };
        });
        if (orderQty > 0) {
            orderDistribution[orderId][itemId].lessStock = orderQty
        }
    });
});


// console.log("orderDistribution", JSON.stringify(orderDistribution, null, 2));